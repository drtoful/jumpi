{% extends "base.xhtml" %}

{% block script %}
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Droid+Sans+Mono">
    <link href="{{ url_for('static', filename="terminal.css") }}" rel="stylesheet" />
    <script type="text/javascript" src="{{ url_for('static', filename="terminal.js") }}"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $(".play").click(function() {
                width = $(this).attr("player-width");
                height = $(this).attr("player-height");
                session = $(this).attr("player-session");
                term = new Terminal(height, width);
                term.attach("#terminal");
                $.getJSON("{{ url_for('user.recordings_json', id=user.id) }}?session="+session, function(data) {
                    term.load(data);
                });
            });
        });
    </script>
{% endblock %}

{% block content %}
<div class="panel panel-default">
    <div class="panel-heading">
        <strong>Recordings for &quot;{{ user.fullname }}&quot;</strong>
    </div>
    <div class="panel-body">
        <p><small>This is a list of all SSH sessions for which a recording exists
        for the user. You can replay every recording in the browser or download
        a ttyrec file.</small></p>
    </div>

    <div class="list-group">
{% for rec in recordings %}
        <div class="list-group-item target-link">
            <span class="fa-stack">
                <i class="fa fa-square fa-stack-2x"></i>
                <i class="fa fa-terminal fa-stack-1x fa-inverse"></i>
            </span>&nbsp;&nbsp;
            <strong>{{ rec.time }}</strong>&nbsp;
            <em>(Session: {{ rec.session_id }})</em>

            <div class="btn btn-group pull-right" style="padding: 0;">
                <button type="button" player-width="{{ rec.width }}" player-height="{{ rec.height }}" player-duration="{{ rec.duration }}" player-session="{{ rec.session_id }}" class="btn btn-xs btn-primary play" data-toggle="modal" data-target=".bs-terminal-modal"><span class="fa fa-video-camera"></span></button>
                <a href="{{ url_for('user.recordings_ttyrec', id=user.id) }}?session={{ rec.session_id }}" type="button" class="btn btn-xs btn-primary"><span class="fa fa-download"></span></a>
            </div>
        </div>
{% endfor %}
        <ul class="pager">
            <li class="previous {% if page<1 %}disabled{% endif %}"><a href="{{ url_for('user.recordings', id=user.id) }}?p={{ page-1 }}"><span aria-hidden="true">&larr;</span> Newer</a></li>
            <li>{{ page+1 }} / {{ end+1 }}</li>
            <li class="next {% if page>=end %}disabled{% endif %}"><a href="{{ url_for('user.recordings', id=user.id) }}?p={{ page+1 }}">Older <span aria-hidden="true">&rarr;</span></a></li>
        </ul>
    </div>
</div>

<div class="modal modal-wide fade bs-terminal-modal" tabindex="-1" role="dialog" arial-hidden="true" aria-labelledby="terminalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="terminalLabel">Terminal Player</h4>
            </div>
            <div class="modal-body">
                <div id="terminal" class="terminal-container"></div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
